{% extends theme("layout.html") %}
{% import "utils.html" as utils %}
{% block content %}
    <h1>{{ _("Item ACL Report") }}</h1>
    {% set button_text = _("Show/Hide items with default ACLs") %}
    <input onclick="$('.moin-acl-default').toggle()" value="{{ button_text }}" class="moin-button" type="button">
    <table class="zebra moin-sortable moin-acl-report" data-sortlist="[[0,0]]">
        <thead>
            <tr>
                <th class="moin-acl-name">{{ _("Item Names") }}</th>
                <th>{{ _("ACL") }}</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items_acls %}
                {% if item['acl_default'] %}
                    {% set default_style = "moin-acl-default" %}
                {% else %}
                    {% set default_style = "" %}
                {% endif %}
                <tr class="{{ default_style }}">
                    <td>
                        <a href="{{ url_for('frontend.show_item', item_name=item['fqname']) }}">
                            {% if item['name'] %}
                                {{ item['name'] | join(', ') }}
                            {% else %}
                                {{ _("Item Id") }}: {{ item['itemid'] }}
                            {% endif %}
                        </a>
                    </td>
                    <td>
                        <span class="hidden">{{ item['acl'] }}</span> {# make column sortable on acl string #}
                        {% if user.may.admin(item['fqname']) %}
                            <form class="moin-acl-form" action="{{ url_for('admin.modify_acl', item_name=item['fqname']) }}" method="POST">
                                <input type="text" class="moin-acl-string" name="{{ item['itemid'] }}" value="{{ item['acl'] }}"/>
                                <input class="moin-button" type="submit" value="{{ _("Save") }}"/>
                            </form>
                        {% else %}
                            {{ item['acl'] }}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
