{% extends theme("layout.html") %}
{% import "utils.html" as utils %}
{% block content %}
    {% if results %}
    <p class="searchstats">
        {{ _("Result: Page %(start_page)d of %(end_page)d.
              Showing results %(start_result)d - %(end_result)d of %(result_len)d (%(runtime).3f secs)",
              start_page=results.pagenum, end_page=results.pagecount,
              start_result=results.offset + 1, end_result=results.offset + results.pagelen,
              result_len=results|length, runtime=results.results.runtime
            )
        }}
    {% endif %}
    {{ gen.form.open(medium_search_form, id='moin-long-searchform', method='get', action=url_for('frontend.show_item', item_name=item_name)) }}
        <div>
            {{ gen.input(medium_search_form['q'], type='search', id='moin-search-query') }}
            {{ gen.input(medium_search_form['submit'], type='submit') }}
            {{ gen.input(medium_search_form['pagelen'], type='hidden', value='25') }}
            {{ forms.render_field_without_markup(gen, medium_search_form['search_in_all'], 'checkbox') }}
            {{ forms.render_errors(medium_search_form) }}
        </div>
    {{ gen.form.close() }}
    </p>
        {% if results %}
        <div class="searchresults">
        <table>
            {% for result in results %}
                {% if result['wikiname'] == cfg.interwikiname %}
                    <tr>
                        <td class="moin-wordbreak">{{ result.pos + 1 }}
                        <a href="{{ url_for_item(item_name=result['name'], wiki_name='Self', rev=result['rev_no']) }}"><b>{{ result['name'] }}</b></a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <p class="info searchhitinfobar">{{ _("Revision: %(rev_no)d Last Change: %(mtime)s", rev_no=result['rev_no'], mtime=result['mtime']|datetimeformat) }}</p>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            {% if user.may.read(result['name']) %}
                                <p class="info foundtext">{{ result.highlights('content')|safe }}</p>
                            {% else %}
                                <p class="info foundtext">{{ _("You don't have read permission for this item.") }}</p>
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td class="moin-wordbreak">{{ result.pos + 1 }}
                        <a class="moin-interwiki" href="{{ url_for_item(item_name=result['name'], wiki_name=result['wikiname'], rev=result['rev_no']) }}"><b>{{ "%s:%s" % (result['wikiname'], result['name']) }}</b></a>
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
        </table>
        </div>
    {% else %}
        <h1>{{ _("No results for '%(query)s'", query=query) }}</h1>
    {% endif %}
{% endblock %}
