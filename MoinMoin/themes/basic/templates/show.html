{% extends theme("layout.html") %}

{% block views %}
{% set exists = storage.has_item(item_name) %}

    <ul class="nav nav-tabs">
        {%- for endpoint, label, title, check_exists in cfg.item_views if not endpoint in cfg.endpoints_excluded %}
            {%- if not check_exists or check_exists and exists %}

                {%- if endpoint == 'frontend.show_item' %}
                    <li>
                        <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                        <span class="icon-eye-open"></span>
                            {{ label }}
                        </a>
                    </li>
                {%- endif %}

                {%- if endpoint == 'frontend.modify_item' and user.may.write(item_name) %}
                    <li>
                        <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                         <span class="icon-pencil"></span>   {{ label }}
                        </a>
                    </li>
                {%- endif %}

                {%- if endpoint == 'frontend.history' %}
                    <li>
                        <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                        <span class="icon-time"></span>
                            {{ label }}
                        </a>
                    </li>
                {%- endif %}

                {%- if endpoint == 'frontend.show_item_meta' %}
                    <li>
                        <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                        <span class="icon-wrench"></span>
                            {{ label }}
                        </a>
                    </li>
                {%- endif %}

                {%- if endpoint == 'frontend.highlight_item' %}
                    <li>
                        <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                        <span class="icon-picture"></span>
                            {{ label }}
                        </a>
                    </li>
                {%- endif %}

                {%- if endpoint == 'frontend.backrefs' %}
                    <li>
                        <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                        <span class="icon-share"></span>
                            {{ label }}
                        </a>
                    </li>
                {%- endif %}

                {%- if endpoint == 'special.comments' %}
                    <li class="moin-toggle-comments-button">
                        <a href="#" title="{{ title }}">
                        <span class="icon-comment"></span>
                            {{ label }}
                        </a>
                    </li>
                {%- endif %}

                {% if endpoint == 'special.transclusions' -%}
                    <li class="moin-transclusions-button">
                        <a href="#" title="{{ title }}">
                        <span class="icon-edit"></span>
                            {{ label }}</a>
                    </li>
                {%- endif %}

            {%- endif %}
        {% endfor %}

    </ul>
{% endblock %}

{% block content %}

    {% block content_data %}
        {% if data_rendered %}
        <div id="moin-content-data">
            {{ data_rendered }}
        </div>
        {% endif %}
    {% endblock %}

{% endblock %}

{% block user_actions %}
    <li class="nav-header">User Actions</li>
    {%- for endpoint, label, title, check_exists in cfg.item_views if not endpoint in cfg.endpoints_excluded %}
        {%- if not check_exists or check_exists and exists %}

            {%- if endpoint == 'frontend.quicklink_item' and user.valid %}
                <li>
                    <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                        <span class="icon-star-empty"></span>
                        {%- if user.is_quicklinked_to([item_name]) %}
                            {{ _('Remove Link') }}
                        {%- else %}
                            {{ _('Add Link') }}
                        {%- endif %}
                    </a>
                </li>
            {%- endif %}

            {%- if endpoint == 'frontend.subscribe_item' and user.valid %}
                <li>
                    <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                        <span class="icon-envelope"></span>
                        {%- if user.is_subscribed_to([item_name]) %}
                            {{ _('Unsubscribe') }}
                        {%- else %}
                            {{ _('Subscribe') }}
                        {%- endif %}
                    </a>
                </li>
            {%- endif %}
        {%- endif %}
    {% endfor %}
{% endblock %}

{% block site_actions %}
    <li class="nav-header">Site Actions</li>
    {%- for endpoint, label, title, check_exists in cfg.item_views if not endpoint in cfg.endpoints_excluded %}
        {%- if not check_exists or check_exists and exists %}

            {%- if endpoint == 'frontend.index' %}
                <li>
                    <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                    <span class="icon-list-alt"></span>
                        {{ label }}
                    </a>
                </li>
            {%- endif %}

            {%- if endpoint == 'frontend.sitemap' %}
                <li>
                    <a href="{{ url_for(endpoint, item_name=item_name) }}" title="{{ title }}" rel="nofollow">
                    <span class="icon-map-marker"></span>
                        {{ label }}
                    </a>
                </li>
            {%- endif %}

        {% endif %}
    {% endfor %}
{% endblock %}

{% block local_panel %}
        
        <!-- user, site, item actions -->
        {{ self.user_actions() }}

        {{ self.site_actions() }}

        {% if rev %}
        <li class="nav-header">Metadata</li>
                <li>{{ _("Revision:") }} {{rev.revid | shorten_id}}</li>
                <li>({{ rev.meta['mtime']|datetimeformat }})</li>
                <li>{{ _("By:") }} {{ utils.editor_info(rev.meta) }}</li>
                <li>{{ _("Size:") }} {{ rev.meta['size'] }}</li>
                <li>{{ _("Type:") }} {{ rev.meta['contenttype'] }}</li>
                {% if rev.meta.tags %}
                <li>
                {{ _("Tags:") }}
                {% for tag in rev.meta.tags -%}
                <a href="{{ url_for('frontend.tagged_items', tag=tag) }}">{{ tag }}</a>{% if not loop.last %}, {% endif %}
                {%- endfor -%}
                </li>
                {% endif %}
        </li>
        {% endif %}

{% endblock %}